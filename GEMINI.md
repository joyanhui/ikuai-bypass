# GEMINI.md - 项目上下文 (ikuai-bypass)

这是一个专门为 iKuai 路由器开发的自动化分流规则同步工具。它通过模拟 Web 管理界面的行为，将远程订阅的 IP/域名列表同步到路由器的分流设置中。

## 核心业务逻辑

### 1. 规则标识约定 (关键)
项目使用特定的备注前缀来识别和管理由本工具创建的规则：
- **唯一标识符**: `IKUAI_BYPASS_`
- **逻辑**: 在进行清理 (`-r clean`) 或更新时，程序会根据备注中是否包含该前缀来判断该规则是否属于本工具管理。**严禁**在代码中无故修改此硬编码前缀。

### 2. 开发策略
- **规则文件更新默认策略**: 默认采用“先增后删” (`-delOldRule after`)。即先成功添加新规则，再删除带有旧标识的规则，以确保在列表下载失败或 API 调用出错时，路由器原有的分流功能不中断。
- **安全策略**: 任何的失败和错误都不应该导致用户数据丢失。
- **安全策略**: 配置文件的覆写 不能被利用来覆盖系统文件 ，只能是文本文件，只能是yaml格式的，后缀只是能yaml/yml，并且不可以有被写入cmd python shell 等危险命令的可能性。
### 3. iKuai API 交互
- 逻辑位于 `pkg/ikuai-api/` 目录。
- 工具并非使用官方公开 SDK，而是通过模拟 Web 登录并发送 JSON POST 请求到 `/Action/call` 等内部接口实现。
- `pkg/ikuai-api/utils.go` 封装了核心的 HTTP 通讯逻辑。

## 调试与运行 (CLI Flags)
本工具高度依赖命令行参数进行调试和功能切换，具体参数的意义参考 @README.md 或 @pkg/config/config.go中flag的定义。

## 开发与贡献规范

### 1. 语言规范 (重要)
- **代码注释与文档**: 必须使用 **中文**。以便于清晰表述业务逻辑和路由器术语。
- **日志打印 (Logs)**: 必须使用 **英文**。确保在不同终端环境下的兼容性。
- **接口返回与错误提示**: 必须使用 **英文**。

### 2. 配置扩展
若增加新功能，需同步修改 `config.yml` 示例、`confYaml.go` 中的结构体定义以及 `readConf` 函数中的默认值处理逻辑。

### 3. 依赖项
项目保持轻量化，主要依赖 `cron` 进行任务调度和 `yaml.v3` 处理配置，尽量避免引入大型第三方框架。
